---
title: "Litter and Trash Cans"
author: "[Alexander Kahanek](https://alexander-kahanek.github.io/) x [Rubbish](https://www.rubbish.love/)"
date: "6/5/2020"
mail: "alexanderkahanek@gmail.com"
#linkedin: "yan-holtz-2477534a"
#twitter: "r_graph_gallery"
github: "Alexander-Kahanek"
home: "alexander-kahanek.github.io"
logo: "rubbish.png"
output:
  epuRate::epurate:
    toc: TRUE
    number_sections: FALSE
    code_folding: "hide"
---


---
title: "Rubbish Analysis"
author: "Alexander Kahanek"
date: "5/14/2020"
output: html_document
---

# Welcome

## testing 2

### testing 3


PROJECT IS UNDER CONSTRUCTION

Project uses R vizualization and Python scripting together

Libraries and reading in clean data csv file

Note: DAYS = Baseline audit, monday preparty, SG day 1, and SG day 2

```{r, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)

####### ALL LIBRARIES USED ###########
options(stringsAsFactors = FALSE)
library(dplyr)
library(reticulate) # for python code
library(leaflet)
library(htmltools)
######################################

# load in python script
source_python("euclidean_script.py") 

# setup to get all types
collection = c('trashCan', 'recyclingCan', 'tobaccoAshCan')

litter = c('paper', 'tobacco', 'unknown', 'plastic', 'food', 'glass')

# icon png files
icons = c("cigarette.png", "cigarette.png", "plastic-bottle.png", "cigarette.png", "cigarette.png", "cigarette.png")

# load in cleaned raw data
raw <- read.csv('clean/clean_rubbish.csv') 
```

# Analysis

Checking distribution of rubbishTypes

```{r}
raw %>% 
  subset(city == 'Redwood City') %>%
  group_by(rubbishType) %>% 
  summarise(
    num_litter = n()
  ) %>% 
  arrange(-num_litter)
```

# Clustering

Restrooms are not needed, they will not be passed through the script

```{r}
clustered_data <- raw %>% 
  subset(city == 'Redwood City') %>% 
  get_euclidean(collection, litter) # python function

clustered_data %>% 
  head()
```

Checking each collection object details

```{r}
clusters <- clustered_data %>% 
  subset(obj_id != -1) %>% # only want objects
  group_by(closest_cent) %>% 
  summarise(
    cent_type = max(cent_type),
    num_litter = n(),
    mean_dist = mean(distance),
    median_dist = median(distance),
    sd_dist = sd(distance),
    max_dist = max(distance),
    lat = mean(lat),
    long = mean(long)
  ) %>% 
  arrange(-num_litter)

clusters %>% 
  head()
```

Checking collection type details

```{r}
clustered_data %>% 
  subset(obj_id != -1) %>% # only want objects
  group_by(cent_type) %>% 
  summarise(
    num_litter = n(),
    mean_dist = mean(distance),
    median_dist = median(distance),
    sd_dist = sd(distance),
    max_dist = max(distance)
  ) %>% 
  arrange(-num_litter)
```


```{r, fig.width=7, fig.height=8}
colors <- colorNumeric(
  # function for color of collection types
  palette = c('#134a47', '#2859b8', 'green'),
  domain = c(1,2,3)
  )

labs <- lapply(seq(nrow(clusters)), function(i) {
  # function for mouseover of circles
  paste0( 'Collection Type: ', clusters[i, "cent_type"], '<p>Number of Litter Objects: ', 
          clusters[i, "num_litter"], '</p>Mean Distance: ', 
          round(clusters[i, "mean_dist"],2),' meters<p>Max Distance: ', 
          round(clusters[i, "max_dist"],2), ' meters</p>' ) 
})

html_legend <- "<img src='open-trash-can.png' style='width:20px;height:20px;'> Trash & Recycling<br/>

<img src='open-trash-can.png' style='width:20px;height:20px;'> Paper<br/>

<img src='cigarette.png' style='width:20px;height:20px;'> Tobacco<br/>

<img src='open-trash-can.png' style='width:20px;height:20px;'> Unknown<br/>

<img src='open-trash-can.png' style='width:20px;height:20px;'> Plastic<br/>

<img src='open-trash-can.png' style='width:20px;height:20px;'> Food<br/>

<img src='open-trash-can.png' style='width:20px;height:20px;'> Glass"

map <- clusters %>% 
  mutate(
    cent_type = ifelse(cent_type == 'trashCan', 1,
                       ifelse(cent_type == 'recyclingCan', 2, 3))
  ) %>% 
  leaflet(width = "100%") %>% 
  setView(lng = -122.2298, lat = 37.48650, zoom = 18) %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addCircles(
    ~long, ~lat,
    radius = ~max_dist,
    color = ~colors(cent_type),
    opacity = ~num_litter/357,
    label = lapply(labs, HTML),
    group = "Collections"
  ) %>% 
  addMarkers(lng = ~long, lat = ~lat,
             icon = makeIcon("open-trash-can.png", "open-trash-can.png", 15,15),
             group = "Collections"
             ) %>% 
  addLayersControl(
    overlayGroups = c("Collections", litter),
    options = layersControlOptions(collapsed = FALSE)
  ) %>% 
  addControl(html = html_legend, position = "bottomleft")



for (i in 1:length(litter)){
  map <- map %>% 
    addMarkers(data = clustered_data %>% 
                 subset(rubbishType == litter[[i]]),
               lng = ~long, lat = ~lat,
               icon = makeIcon(icons[[i]], icons[[i]], 7,7),
               group = litter[[i]]
               ) 
}

map

```



```{r}

```




